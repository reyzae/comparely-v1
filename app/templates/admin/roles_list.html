{% extends "admin/base_admin.html" %}

{% block title %}Roles{% endblock %}
{% block breadcrumb %}Roles Management{% endblock %}

{% block extra_css %}
<style>
    /* ========================================
       ROLE MANAGEMENT - Search Bar Fixes
    ======================================== */

    /* FIX #3: Better Layout Alignment */
    .card form[action="/admin/roles"] {
        display: flex;
        gap: 0.75rem;
        align-items: flex-end;
        flex-wrap: wrap;
    }

    /* FIX #2: Larger Search Input */
    .card form[action="/admin/roles"] .form-group:first-child {
        flex: 1;
        min-width: 250px;
        /* Wider search box */
        margin-bottom: 0;
    }

    .card form[action="/admin/roles"] .form-input {
        width: 100%;
    }

    /* FIX #1: Consistent Button Sizes */
    .card form[action="/admin/roles"] .btn {
        min-height: 48px;
        padding: 0.75rem 1.25rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
    }

    .card form[action="/admin/roles"] .form-group {
        margin-bottom: 0;
    }

    /* FIX #4: Mobile Optimization */
    @media (max-width: 768px) {
        .card form[action="/admin/roles"] {
            flex-direction: column;
        }

        .card form[action="/admin/roles"] .form-group {
            width: 100%;
        }

        .card form[action="/admin/roles"] .form-group:first-child {
            min-width: unset;
        }

        .card form[action="/admin/roles"] .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Role Management</h1>
    <p class="page-description">Kelola role dan permissions</p>
</div>

<!-- Search Bar -->
<div class="card">
    <form method="GET" action="/admin/roles" style="display: flex; gap: 1rem; align-items: end;">
        <div class="form-group" style="flex: 1; margin-bottom: 0;">
            <label class="form-label">Search</label>
            <input type="text" name="search" placeholder="Cari role..." value="{{ search }}" class="form-input">
        </div>

        <div class="form-group" style="margin-bottom: 0;">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search"></i> Search
            </button>
        </div>

        <div class="form-group" style="margin-bottom: 0;">
            <a href="/admin/roles/new" class="btn btn-success">
                <i class="fas fa-plus-circle"></i> Add New Role
            </a>
        </div>
    </form>
</div>

<!-- Roles Table -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">All Roles</h3>
    </div>

    <div class="table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Permissions</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if roles %}
                {% for role in roles %}
                <tr>
                    <td>{{ role.id }}</td>
                    <td><strong>{{ role.name }}</strong></td>
                    <td>{{ role.description or '-' }}</td>
                    <td>
                        {% if role.permissions %}
                        <span class="badge badge-primary">{{ role.permissions }}</span>
                        {% else %}
                        <span class="badge">No Permissions</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <!-- Edit button -->
                        <a href="/admin/roles/{{ role.id }}/edit" class="btn btn-sm btn-edit">
                            <i class="fas fa-edit"></i>
                        </a>

                        <!-- Delete button -->
                        <form method="POST" action="/admin/roles/{{ role.id }}/delete" style="display: inline;"
                            data-role-name="{{ role.name }}" onsubmit="return confirmDelete(this)">
                            <button type="submit" class="btn btn-sm btn-delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" class="text-center" style="padding: 2rem;">
                        {% if search %}
                        <i class="fas fa-search" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p>Tidak ada role yang cocok dengan "{{ search }}"</p>
                        {% else %}
                        <i class="fas fa-user-shield" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p>Belum ada role. <a href="/admin/roles/new">Tambahkan role pertama</a></p>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}" class="page-link">
        <i class="fas fa-chevron-left"></i> Previous
    </a>
    {% endif %}

    <span class="page-info">Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %} <a href="?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}"
        class="page-link">
        Next <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Confirm delete
    function confirmDelete(form) {
        const roleName = form.getAttribute('data-role-name');
        return confirm(`Apakah Anda yakin ingin menghapus role "${roleName}"?`);
    }
</script>
{% endblock %}